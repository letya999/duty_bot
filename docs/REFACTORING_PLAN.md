# –ü–ª–∞–Ω –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Duty Bot

**–°—Ç–∞—Ç—É—Å:** üìã –í –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
**–í–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞:** 1.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-24
**–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** 4/10
**–¶–µ–ª–µ–≤–∞—è –æ—Ü–µ–Ω–∫–∞:** 8/10

---

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º](#–æ–±–∑–æ—Ä-–ø—Ä–æ–±–ª–µ–º)
2. [–¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](#—Ü–µ–ª–∏-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
3. [–§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ñ–∞–∑–∞-1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∏-–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
4. [–§–∞–∑–∞ 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](#—Ñ–∞–∑–∞-2-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
5. [–§–∞–∑–∞ 3: –û—á–∏—Å—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](#—Ñ–∞–∑–∞-3-–æ—á–∏—Å—Ç–∫–∞-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
6. [–§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#—Ñ–∞–∑–∞-4-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
7. [–ì—Ä–∞—Ñ–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è](#–≥—Ä–∞—Ñ–∏–∫-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

---

## üî¥ –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª `app/web/api.py` (1559 —Å—Ç—Ä–æ–∫)**
   - –°–æ–¥–µ—Ä–∂–∏—Ç 55+ endpoints
   - –°–º–µ—à–∏–≤–∞–µ—Ç —Å–ª–æ–∏: –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä + —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π + –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î –≤ 25+ –º–µ—Å—Ç–∞—Ö
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ

2. **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î –º–∏–Ω—É—è —Å–µ—Ä–≤–∏—Å—ã**
   - 70+ –º–µ—Å—Ç –≤ –∫–æ–¥–µ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `db.get()`, `db.execute()`, `db.commit()`
   - –ù–∞—Ä—É—à–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤
   - –ó–∞—Ç—Ä—É–¥–Ω—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏ –∫–æ–¥–∞**
   - 66% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É `app/web/api.py` –∏ `app/routes/miniapp.py`
   - –õ–æ–≥–∏–∫–∞ workspace creation –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 8 —Ä–∞–∑ –≤ handlers
   - –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 8 —Ä–∞–∑ –≤ commands

### –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

4. **–ë–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã —Å–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
   - `CommandHandler` - 797 —Å—Ç—Ä–æ–∫, 30+ –º–µ—Ç–æ–¥–æ–≤
   - `TelegramHandler` - 752 —Å—Ç—Ä–æ–∫–∏, 9 command handlers

5. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã**
   - `app/routes/miniapp.py` - –¥—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å `app/web/api.py`

---

## üéØ –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

- [ ] **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤**: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã ‚Üí –°–µ—Ä–≤–∏—Å—ã ‚Üí –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Üí –ë–î
- [ ] **–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –£–º–µ–Ω—å—à–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 66% –¥–æ <10%
- [ ] **–£–ª—É—á—à–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏
- [ ] **–û–±–ª–µ–≥—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–¥–µ–ª–∞—Ç—å –∫–æ–¥ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º —á–µ—Ä–µ–∑ unit-—Ç–µ—Å—Ç—ã
- [ ] **–£–ª—É—á—à–∏—Ç—å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ <300 —Å—Ç—Ä–æ–∫

---

## üèóÔ∏è –§–ê–ó–ê 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 10-12 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ù–û
**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã)

---

### –ó–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–Ω—ã–π —Å–ª–æ–π

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —É–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤.

**–§–∞–π–ª—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é:**
```
app/repositories/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ base_repository.py      # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å CRUD –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
‚îú‚îÄ‚îÄ user_repository.py      # –î–æ—Å—Ç—É–ø –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
‚îú‚îÄ‚îÄ team_repository.py      # –î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º
‚îú‚îÄ‚îÄ schedule_repository.py  # –î–æ—Å—Ç—É–ø –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º
‚îú‚îÄ‚îÄ workspace_repository.py # –î–æ—Å—Ç—É–ø –∫ workspace'–∞–º
‚îú‚îÄ‚îÄ shift_repository.py     # –î–æ—Å—Ç—É–ø –∫ —Å–º–µ–Ω–∞–º
‚îú‚îÄ‚îÄ escalation_repository.py # –î–æ—Å—Ç—É–ø –∫ —ç—Å–∫–∞–ª–∞—Ü–∏—è–º
‚îî‚îÄ‚îÄ audit_repository.py     # –î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –¥–µ–π—Å—Ç–≤–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
```

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

- `BaseRepository` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ CRUD –º–µ—Ç–æ–¥—ã:
  - `get_by_id(id) -> Model | None`
  - `list_all() -> list[Model]`
  - `create(data) -> Model`
  - `update(id, data) -> Model`
  - `delete(id) -> bool`

- –ö–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç `BaseRepository` –∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# app/repositories/base_repository.py
from typing import Generic, TypeVar, List, Optional
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select

T = TypeVar('T')

class BaseRepository(Generic[T]):
    def __init__(self, db: AsyncSession, model_class: type[T]):
        self.db = db
        self.model_class = model_class

    async def get_by_id(self, id: int) -> Optional[T]:
        return await self.db.get(self.model_class, id)

    async def list_all(self, limit: int = 100, offset: int = 0) -> List[T]:
        stmt = select(self.model_class).limit(limit).offset(offset)
        result = await self.db.execute(stmt)
        return result.scalars().all()

    async def create(self, obj: T) -> T:
        self.db.add(obj)
        await self.db.commit()
        await self.db.refresh(obj)
        return obj

    async def update(self, id: int, **kwargs) -> Optional[T]:
        obj = await self.get_by_id(id)
        if not obj:
            return None
        for key, value in kwargs.items():
            setattr(obj, key, value)
        await self.db.commit()
        await self.db.refresh(obj)
        return obj

    async def delete(self, id: int) -> bool:
        obj = await self.get_by_id(id)
        if not obj:
            return False
        await self.db.delete(obj)
        await self.db.commit()
        return True
```

```python
# app/repositories/user_repository.py
from sqlalchemy import select
from app.models import User
from .base_repository import BaseRepository

class UserRepository(BaseRepository[User]):
    def __init__(self, db):
        super().__init__(db, User)

    async def get_by_workspace(self, workspace_id: int) -> list[User]:
        stmt = select(User).where(User.workspace_id == workspace_id)
        result = await self.db.execute(stmt)
        return result.scalars().all()

    async def get_by_telegram(self, workspace_id: int, telegram_id: int) -> User | None:
        stmt = select(User).where(
            (User.workspace_id == workspace_id) &
            (User.telegram_id == telegram_id)
        )
        result = await self.db.execute(stmt)
        return result.scalar_one_or_none()

    async def get_admins(self, workspace_id: int) -> list[User]:
        stmt = select(User).where(
            (User.workspace_id == workspace_id) &
            (User.is_admin == True)
        )
        result = await self.db.execute(stmt)
        return result.scalars().all()
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `app/repositories/`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `BaseRepository` —Å–æ –≤—Å–µ–º–∏ CRUD –º–µ—Ç–æ–¥–∞–º–∏
- [ ] –°–æ–∑–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è: User, Team, Schedule, Workspace, Shift, Escalation
- [ ] –ö–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–º–µ–µ—Ç –Ω—É–∂–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–ø—Ä–∏–º–µ—Ä—ã –≤—ã—à–µ)
- [ ] –í—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —á–µ—Ä–µ–∑ dependency injection –≤ `app/dependencies.py` (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, —Å–æ–∑–¥–∞—Ç—å)
- [ ] –¢–µ—Å—Ç—ã: –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π (optional –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ)

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –í—Å—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î –¥–ª—è User, Team, Schedule —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –Ω–µ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `db.get()`

---

### –ó–∞–¥–∞—á–∞ 1.2: –†–∞—Å—à–∏—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–µ—Ç–æ–¥—ã –≤ —Å–µ—Ä–≤–∏—Å—ã –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π `WorkspaceService`. –°–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `app/services/user_service.py` - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –ø—Ä–æ–º–æ—É—à–µ–Ω–∞/–¥–µ–º–æ—É—à–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `app/services/team_service.py` - –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–µ—Ç–æ–¥—ã
- `app/services/schedule_service.py` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

**–§–∞–π–ª—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é:**
- `app/services/workspace_service.py` - –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å workspace'–∞–º–∏

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# app/services/user_service.py - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã
class UserService:
    def __init__(self, user_repository: UserRepository, audit_repository: AuditRepository):
        self.user_repository = user_repository
        self.audit_repository = audit_repository

    # –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
    async def get_user_by_id(self, user_id: int, workspace_id: int) -> User | None:
        """–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π workspace"""
        user = await self.user_repository.get_by_id(user_id)
        if user and user.workspace_id == workspace_id:
            return user
        return None

    async def promote_user(self, user_id: int, workspace_id: int, admin_id: int) -> User:
        """–ü—Ä–æ–º–æ—É—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∞–¥–º–∏–Ω–∞"""
        user = await self.get_user_by_id(user_id, workspace_id)
        if not user:
            raise ValueError("User not found in workspace")

        user = await self.user_repository.update(user_id, is_admin=True)

        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
        await self.audit_repository.log_action(
            workspace_id=workspace_id,
            admin_id=admin_id,
            action=f"Promoted user {user.name} to admin",
            target_user_id=user_id
        )
        return user

    async def demote_user(self, user_id: int, workspace_id: int, admin_id: int) -> User:
        """–ü–æ–Ω–∏–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∞–¥–º–∏–Ω–æ–≤"""
        user = await self.get_user_by_id(user_id, workspace_id)
        if not user:
            raise ValueError("User not found in workspace")

        user = await self.user_repository.update(user_id, is_admin=False)

        await self.audit_repository.log_action(
            workspace_id=workspace_id,
            admin_id=admin_id,
            action=f"Demoted user {user.name} from admin",
            target_user_id=user_id
        )
        return user
```

```python
# app/services/workspace_service.py - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
from app.repositories import WorkspaceRepository, UserRepository
from app.models import Workspace, User

class WorkspaceService:
    def __init__(self, workspace_repo: WorkspaceRepository, user_repo: UserRepository):
        self.workspace_repo = workspace_repo
        self.user_repo = user_repo

    async def get_or_create_telegram_workspace(
        self,
        chat_id: int,
        chat_title: str | None = None
    ) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å workspace –∏–∑ Telegram chat"""
        workspace = await self.workspace_repo.get_by_telegram_chat(chat_id)

        if not workspace:
            workspace = Workspace(
                name=chat_title or f"Chat {chat_id}",
                telegram_chat_id=chat_id,
                platform="telegram"
            )
            workspace = await self.workspace_repo.create(workspace)

        return workspace.id

    async def get_or_create_slack_workspace(
        self,
        team_id: str,
        team_name: str | None = None
    ) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å workspace –∏–∑ Slack team"""
        workspace = await self.workspace_repo.get_by_slack_team(team_id)

        if not workspace:
            workspace = Workspace(
                name=team_name or f"Slack Team {team_id}",
                slack_team_id=team_id,
                platform="slack"
            )
            workspace = await self.workspace_repo.create(workspace)

        return workspace.id
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω `app/services/workspace_service.py` —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - `get_or_create_telegram_workspace(chat_id, chat_title)`
  - `get_or_create_slack_workspace(team_id, team_name)`
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω `app/services/user_service.py` —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - `get_user_by_id(user_id, workspace_id)`
  - `promote_user(user_id, workspace_id, admin_id)`
  - `demote_user(user_id, workspace_id, admin_id)`
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∞ –Ω–µ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ audit repository
- [ ] –ù–µ—Ç –∏–º–ø–æ—Ä—Ç–æ–≤ `db.execute()` –∏–ª–∏ –ø—Ä—è–º—ã—Ö SQLAlchemy –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å workspace'–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

---

### –ó–∞–¥–∞—á–∞ 1.3: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å app/web/api.py –∏—Å–ø–æ–ª—å–∑—É—è —Å–µ—Ä–≤–∏—Å—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `app/web/api.py` (1559 —Å—Ç—Ä–æ–∫) —á—Ç–æ–±—ã –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–µ—Ä–≤–∏—Å—ã –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î. –≠—Ç–æ –≤—Å–µ –µ—â–µ –æ–¥–∏–Ω —Ñ–∞–π–ª, –Ω–æ –∫–æ–¥ –±—É–¥–µ—Ç —á–∏—â–µ.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `app/web/api.py` - —É–±—Ä–∞—Ç—å –≤—Å–µ –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**

```python
# –î–û (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ):
@router.post("/users/{user_id}/promote")
async def promote_user(user_id: int, current_user: User = Depends(...)):
    if not current_user.is_admin:  # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
        raise HTTPException(status_code=403)

    target_user = await db.get(User, user_id)  # –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î
    if not target_user or target_user.workspace_id != current_user.workspace_id:
        raise HTTPException(status_code=400)

    target_user.is_admin = True  # –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
    await db.commit()  # –ö–æ–º–º–∏—Ç –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ

# –ü–û–°–õ–ï (—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º):
@router.post("/users/{user_id}/promote")
async def promote_user(
    user_id: int,
    current_user: User = Depends(get_current_admin_user),  # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ dependency
    user_service: UserService = Depends(get_user_service)
):
    promoted_user = await user_service.promote_user(
        user_id=user_id,
        workspace_id=current_user.workspace_id,
        admin_id=current_user.id
    )
    return {"success": True, "user": promoted_user}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –í—Å–µ endpoints –≤ `app/web/api.py` –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–µ—Ä–≤–∏—Å—ã –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
- [ ] –ù–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `db.get()`, `db.execute()`, `db.commit()` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
- [ ] –í—Å–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç dependency injection –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ (–∞–¥–º–∏–Ω-–ø—Ä–æ–≤–µ—Ä–∫–∏) –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ dependencies –∏–ª–∏ —Å–µ—Ä–≤–∏—Å—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] –ö–æ–¥ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç)

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- `app/web/api.py` –±–æ–ª—å—à–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä—è–º—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ë–î
- –ö–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ HTTP –ª–æ–≥–∏–∫–µ, –∞ –Ω–µ –Ω–∞ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏

---

## üîÑ –§–ê–ó–ê 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 8-10 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í–ê–ñ–ù–û
**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã

---

### –ó–∞–¥–∞—á–∞ 2.1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ telegram_handler.py

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ `app/handlers/telegram_handler.py`. –¢–µ–∫—É—â–∏–π –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ª–æ–≥–∏–∫—É workspace creation –∏ user creation –≤ –∫–∞–∂–¥–æ–º command handler.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `app/handlers/telegram_handler.py` - —É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å workspace_service

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

–°–æ–∑–¥–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤ TelegramHandler –¥–ª—è —É–±—Ä–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# app/handlers/telegram_handler.py

class TelegramHandler:
    def __init__(self, ..., workspace_service: WorkspaceService, user_service: UserService):
        self.workspace_service = workspace_service
        self.user_service = user_service

    async def _get_workspace_and_user(self, update, context):
        """–ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å workspace –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)"""
        workspace_id = await self.workspace_service.get_or_create_telegram_workspace(
            chat_id=update.effective_chat.id,
            chat_title=update.effective_chat.title
        )

        user = await self.user_service.get_or_create_by_telegram(
            workspace_id=workspace_id,
            telegram_id=update.effective_user.id,
            name=update.effective_user.first_name
        )

        return workspace_id, user

    async def duty_command(self, update, context):
        """–ö–æ–º–∞–Ω–¥–∞ /duty"""
        workspace_id, user = await self._get_workspace_and_user(update, context)
        # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã

    async def team_command(self, update, context):
        """–ö–æ–º–∞–Ω–¥–∞ /team"""
        workspace_id, user = await self._get_workspace_and_user(update, context)
        # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã

    # –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ—Ç –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `_get_workspace_and_user()` –≤ TelegramHandler
- [ ] –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è workspace –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ `WorkspaceService`
- [ ] –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ `UserService`
- [ ] –í—Å–µ command handlers –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ `_get_workspace_and_user()`
- [ ] –£–¥–∞–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_or_create_telegram_workspace()` –∏–∑ handler (–æ–Ω–∞ —Ç–µ–ø–µ—Ä—å –≤ —Å–µ—Ä–≤–∏—Å–µ)
- [ ] –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Telegram

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –ö–æ–¥ workspace creation –±–æ–ª—å—à–µ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º command handler
- –†–∞–∑–º–µ—Ä `telegram_handler.py` —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ 50+ —Å—Ç—Ä–æ–∫

---

### –ó–∞–¥–∞—á–∞ 2.2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ commands/handlers.py

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å CommandHandler –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `app/commands/handlers.py` - —É–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –¥–∞—Ç—ã

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# app/utils/date_utils.py - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
from datetime import datetime, date
from zoneinfo import ZoneInfo
from app.config import Settings

def get_user_today(settings: Settings, date_obj: date | None = None) -> date:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –≤ timezone –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if date_obj is not None:
        return date_obj
    tz = ZoneInfo(settings.timezone)
    return datetime.now(tz).date()
```

```python
# app/commands/handlers.py - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É

from app.utils.date_utils import get_user_today

class CommandHandler:
    async def handle_duty_command(self, message, user, team_service, settings):
        today = get_user_today(settings)  # –í–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–∞ 8 —Ä–∞–∑
        # ...–æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
```

–†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å –Ω–∞ —á–∞—Å—Ç–∏:

```python
# app/commands/handlers/__init__.py
from .duty_command_handler import DutyCommandHandler
from .team_command_handler import TeamCommandHandler

# app/commands/handlers/duty_command_handler.py
class DutyCommandHandler:
    async def handle(self, message, user, services):
        # –õ–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /duty (~100 —Å—Ç—Ä–æ–∫)
        pass

# app/commands/handlers/team_command_handler.py
class TeamCommandHandler:
    async def handle(self, message, user, services):
        # –õ–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /team (~100 —Å—Ç—Ä–æ–∫)
        pass
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `app/utils/date_utils.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `get_user_today()`
- [ ] –í—Å–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `get_user_today()`
- [ ] –õ–æ–≥–∏–∫–∞ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –≤—ã–¥–µ–ª–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å-handler (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ, –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ñ–∞–∑–µ 3)
- [ ] –†–∞–∑–º–µ—Ä `app/commands/handlers.py` —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ 150+ —Å—Ç—Ä–æ–∫
- [ ] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ Telegram/Slack

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
- –ö–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–π –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π

---

### –ó–∞–¥–∞—á–∞ 2.3: –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è API (miniapp + web)

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–û–±—ä–µ–¥–∏–Ω–∏—Ç—å `app/web/api.py` –∏ `app/routes/miniapp.py` –≤ –µ–¥–∏–Ω—ã–π API —Å —Ä–∞–∑–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏/—Å–æ–∑–¥–∞–Ω–∏—é:**
- `app/routes/miniapp.py` - —É–¥–∞–ª–∏—Ç—å (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å)
- `app/web/api.py` - –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å/–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –±–æ–ª–µ–µ –æ–±—â–µ–µ –º–µ—Å—Ç–æ
- `app/api/` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```
app/api/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ dependencies.py      # –û–±—â–∏–µ dependencies –¥–ª—è –≤—Å–µ—Ö API
‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ users.py        # Endpoints /api/v1/users
‚îÇ   ‚îú‚îÄ‚îÄ teams.py        # Endpoints /api/v1/teams
‚îÇ   ‚îú‚îÄ‚îÄ schedules.py    # Endpoints /api/v1/schedules
‚îÇ   ‚îú‚îÄ‚îÄ shifts.py       # Endpoints /api/v1/shifts
‚îÇ   ‚îú‚îÄ‚îÄ admin.py        # Endpoints /api/v1/admin
‚îÇ   ‚îî‚îÄ‚îÄ escalations.py  # Endpoints /api/v1/escalations
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ bearer.py       # JWT/Bearer Token –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ telegram.py     # Telegram Init Data –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py # –û–±—â–∏–µ auth dependencies
‚îî‚îÄ‚îÄ routes.py           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ä–æ—É—Ç–æ–≤
```

```python
# app/api/dependencies.py
from fastapi import Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from app.services import UserService, TeamService, ScheduleService
from app.repositories import UserRepository, TeamRepository, ScheduleRepository
from app.database import get_db

async def get_user_service(db: AsyncSession = Depends(get_db)) -> UserService:
    return UserService(
        user_repository=UserRepository(db),
        audit_repository=AuditRepository(db)
    )

async def get_team_service(db: AsyncSession = Depends(get_db)) -> TeamService:
    return TeamService(team_repository=TeamRepository(db))

# –∏ —Ç.–¥. –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```

```python
# app/api/auth/dependencies.py
async def get_current_user_from_bearer(
    token: str = Header(...),
    user_service: UserService = Depends(get_user_service)
) -> User:
    """–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Bearer Token"""
    user = await authenticate_bearer_token(token)
    if not user:
        raise HTTPException(status_code=401)
    return user

async def get_current_user_from_telegram(
    init_data: str = Header(...),
    user_service: UserService = Depends(get_user_service)
) -> User:
    """–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Init Data"""
    user_data = verify_telegram_init_data(init_data)
    if not user_data:
        raise HTTPException(status_code=401)
    # –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID
    user = await user_service.get_by_telegram(user_data['id'])
    if not user:
        raise HTTPException(status_code=401)
    return user

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ endpoints:
@router.get("/api/v1/schedules")
async def list_schedules(
    current_user: User = Depends(get_current_user)  # –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ auth
):
    # –û–¥–∏–Ω –∫–æ–¥ –¥–ª—è –æ–±–æ–∏—Ö —Å–ª—É—á–∞–µ–≤
    return await schedule_service.list_by_workspace(current_user.workspace_id)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `app/api/v1/` —Å –º–æ–¥—É–ª—è–º–∏ users, teams, schedules, shifts, admin, escalations
- [ ] –í—Å–µ endpoints –∏–∑ `app/web/api.py` –∏ `app/routes/miniapp.py` –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—è—Ö
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `app/api/auth/` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Bearer Token –∏ Telegram Init Data
- [ ] `app/routes/miniapp.py` —É–¥–∞–ª–µ–Ω (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ `/api/v1/`)
- [ ] –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –§—Ä–æ–Ω—Ç–µ–Ω–¥ (web –∏ miniapp) —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–æ (–æ–¥–∏–Ω endpoint –¥–ª—è –æ–±–æ–∏—Ö API)

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –í–º–µ—Å—Ç–æ 2 –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (api.py + miniapp.py) –µ—Å—Ç—å 6 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ–ª—å—à–µ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ endpoints

---

## üßπ –§–ê–ó–ê 3: –û—á–∏—Å—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 6-8 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –£–õ–£–ß–®–ï–ù–ò–Ø
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—ã, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, —É–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

---

### –ó–∞–¥–∞—á–∞ 3.1: –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –∏ decorators

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ decorators –¥–ª—è —É–±—Ä–∞–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

**–§–∞–π–ª—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é:**
- `app/utils/decorators.py` - decorators –¥–ª—è handlers
- `app/utils/validators.py` - –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- `app/utils/exceptions.py` - –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# app/utils/exceptions.py
class DutyBotException(Exception):
    """–ë–∞–∑–æ–≤–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    pass

class ValidationError(DutyBotException):
    """–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏"""
    pass

class AuthorizationError(DutyBotException):
    """–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    pass

class NotFoundError(DutyBotException):
    """–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"""
    pass

class WorkspaceNotFoundError(NotFoundError):
    """Workspace –Ω–µ –Ω–∞–π–¥–µ–Ω"""
    pass

class UserNotFoundError(NotFoundError):
    """–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"""
    pass
```

```python
# app/utils/decorators.py
from functools import wraps

def with_workspace_context(func):
    """Decorator –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è workspace –∏–∑ update"""
    @wraps(func)
    async def wrapper(self, update, context):
        workspace_id = await self.workspace_service.get_or_create_telegram_workspace(
            chat_id=update.effective_chat.id,
            chat_title=update.effective_chat.title
        )
        user = await self.user_service.get_or_create_by_telegram(
            workspace_id=workspace_id,
            telegram_id=update.effective_user.id,
            name=update.effective_user.first_name
        )
        context.workspace_id = workspace_id
        context.current_user = user
        return await func(self, update, context)
    return wrapper

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
# @with_workspace_context
# async def duty_command(self, update, context):
#     workspace_id = context.workspace_id
#     user = context.current_user
```

```python
# app/utils/validators.py
from datetime import date, datetime
from app.utils.exceptions import ValidationError

def validate_date_range(start_date: date, end_date: date) -> None:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç"""
    if start_date > end_date:
        raise ValidationError("start_date must be before end_date")

def validate_user_id_in_workspace(user_id: int, workspace_id: int) -> None:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç workspace"""
    # –≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ, –Ω–æ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
    if user_id <= 0 or workspace_id <= 0:
        raise ValidationError("Invalid user_id or workspace_id")
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `app/utils/` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –º–æ–¥—É–ª—è–º–∏:
  - `date_utils.py` (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ñ–∞–∑—ã)
  - `exceptions.py` —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏
  - `decorators.py` —Å decorators –¥–ª—è handlers
  - `validators.py` —Å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏
- [ ] –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –≤–º–µ—Å—Ç–æ generic HTTPException
- [ ] Decorators –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ handlers –¥–ª—è —É–±—Ä–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ö–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–π –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ –≤ handlers
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ

---

### –ó–∞–¥–∞—á–∞ 3.2: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ (exception handler) –¥–ª—è –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `app/main.py` - –¥–æ–±–∞–≤–∏—Ç—å exception handlers

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# app/main.py
from fastapi import FastAPI
from fastapi.responses import JSONResponse
from app.utils.exceptions import (
    DutyBotException, ValidationError, AuthorizationError, NotFoundError
)

app = FastAPI()

@app.exception_handler(ValidationError)
async def validation_error_handler(request, exc):
    return JSONResponse(
        status_code=400,
        content={"detail": str(exc), "error_type": "validation_error"}
    )

@app.exception_handler(AuthorizationError)
async def authorization_error_handler(request, exc):
    return JSONResponse(
        status_code=403,
        content={"detail": str(exc), "error_type": "authorization_error"}
    )

@app.exception_handler(NotFoundError)
async def not_found_error_handler(request, exc):
    return JSONResponse(
        status_code=404,
        content={"detail": str(exc), "error_type": "not_found_error"}
    )

@app.exception_handler(DutyBotException)
async def general_error_handler(request, exc):
    return JSONResponse(
        status_code=500,
        content={"detail": str(exc), "error_type": "internal_error"}
    )
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω—ã exception handlers –¥–ª—è –≤—Å–µ—Ö –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- [ ] Exception handlers –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Å error_type
- [ ] –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ HTTPException
- [ ] –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å logging —Å–∏—Å—Ç–µ–º–∞)
- [ ] –°—Ç–∞—Ç—É—Å –∫–æ–¥—ã HTTP —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ö–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å —Ç–∏–ø–∞–º–∏

---

### –ó–∞–¥–∞—á–∞ 3.3: –î–æ–±–∞–≤–∏—Ç—å Pydantic schemas –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å Pydantic schemas –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–§–∞–π–ª—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é:**
- `app/schemas/` - –Ω–æ–≤–∞—è –ø–∞–ø–∫–∞ —Å Pydantic –º–æ–¥–µ–ª—è–º–∏
- `app/schemas/__init__.py`
- `app/schemas/user.py`
- `app/schemas/team.py`
- `app/schemas/schedule.py`
- `app/schemas/common.py` - –æ–±—â–∏–µ —Å—Ö–µ–º—ã

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# app/schemas/user.py
from pydantic import BaseModel, Field, EmailStr
from datetime import datetime

class UserBase(BaseModel):
    name: str = Field(..., min_length=1, max_length=255)
    email: EmailStr | None = None
    timezone: str = Field(default="UTC")

class UserCreate(UserBase):
    telegram_id: int | None = None
    slack_id: str | None = None

class UserUpdate(BaseModel):
    name: str | None = None
    email: EmailStr | None = None
    timezone: str | None = None

class UserResponse(UserBase):
    id: int
    workspace_id: int
    is_admin: bool
    created_at: datetime

    class Config:
        from_attributes = True

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API:
@router.post("/users", response_model=UserResponse)
async def create_user(
    user_data: UserCreate,
    current_user: User = Depends(get_current_admin_user),
    user_service: UserService = Depends(get_user_service)
):
    user = await user_service.create_user(
        workspace_id=current_user.workspace_id,
        **user_data.model_dump()
    )
    return user
```

```python
# app/schemas/schedule.py
from pydantic import BaseModel, Field
from datetime import date

class ScheduleBase(BaseModel):
    team_id: int
    user_id: int
    date: date

class ScheduleCreate(ScheduleBase):
    notes: str | None = None

class ScheduleUpdate(BaseModel):
    user_id: int | None = None
    date: date | None = None
    notes: str | None = None

class ScheduleResponse(ScheduleBase):
    id: int
    notes: str | None = None

    class Config:
        from_attributes = True
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `app/schemas/` —Å –º–æ–¥—É–ª—è–º–∏ –¥–ª—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
- [ ] –ö–∞–∂–¥—ã–π endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Pydantic schemas
- [ ] Schemas –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Field()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] Schemas –∏–º–µ—é—Ç `Config` —Å `from_attributes = True` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SQLAlchemy –º–æ–¥–µ–ª—è–º–∏
- [ ] OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ–ª–µ–π
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Pydantic

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –í—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Pydantic
- OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –ø–æ–Ω—è—Ç–Ω–∞

---

## üìö –§–ê–ó–ê 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 8-10 —á–∞—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–Ø
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

### –ó–∞–¥–∞—á–∞ 4.1: –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pytest –∏ –º–æ–∫–æ–≤.

**–§–∞–π–ª—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é:**
```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py                    # Fixtures –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ fixtures.py                    # –§–∞–±—Ä–∏–∫–∏ –∏ –º–æ–∫–∏
‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_user_service.py
‚îÇ   ‚îú‚îÄ‚îÄ test_team_service.py
‚îÇ   ‚îú‚îÄ‚îÄ test_schedule_service.py
‚îÇ   ‚îú‚îÄ‚îÄ test_workspace_service.py
‚îÇ   ‚îî‚îÄ‚îÄ test_repositories.py
‚îî‚îÄ‚îÄ integration/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ test_api.py
```

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# tests/conftest.py
import pytest
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker
from unittest.mock import AsyncMock, MagicMock
from app.repositories import UserRepository, TeamRepository
from app.services import UserService, TeamService

@pytest.fixture
async def mock_db():
    """–ú–æ–∫ –ë–î —Å–µ—Å—Å–∏–∏"""
    return AsyncMock(spec=AsyncSession)

@pytest.fixture
async def user_repository(mock_db):
    return UserRepository(mock_db)

@pytest.fixture
async def user_service(user_repository):
    audit_repo = MagicMock()
    return UserService(user_repository, audit_repo)

# tests/unit/test_user_service.py
import pytest
from app.models import User
from app.utils.exceptions import NotFoundError

@pytest.mark.asyncio
class TestUserService:
    async def test_get_user_by_id_success(self, user_service, user_repository):
        # Arrange
        user_id = 1
        workspace_id = 100
        expected_user = User(id=user_id, workspace_id=workspace_id, name="Test User")
        user_repository.get_by_id = AsyncMock(return_value=expected_user)

        # Act
        result = await user_service.get_user_by_id(user_id, workspace_id)

        # Assert
        assert result == expected_user
        user_repository.get_by_id.assert_called_once_with(user_id)

    async def test_get_user_by_id_not_found(self, user_service, user_repository):
        # Arrange
        user_repository.get_by_id = AsyncMock(return_value=None)

        # Act & Assert
        with pytest.raises(NotFoundError):
            await user_service.get_user_by_id(999, 100)

    async def test_promote_user_success(self, user_service, user_repository):
        # Arrange
        user_id = 1
        workspace_id = 100
        user = User(id=user_id, workspace_id=workspace_id, is_admin=False)
        user_repository.get_by_id = AsyncMock(return_value=user)
        user_repository.update = AsyncMock(return_value=User(id=user_id, is_admin=True))

        # Act
        result = await user_service.promote_user(user_id, workspace_id, admin_id=2)

        # Assert
        assert result.is_admin is True
        user_repository.update.assert_called_once()
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `tests/` —Å conftest.py
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
  - `UserService` (–º–∏–Ω–∏–º—É–º 5 —Ç–µ—Å—Ç–æ–≤)
  - `TeamService` (–º–∏–Ω–∏–º—É–º 3 —Ç–µ—Å—Ç–∞)
  - `ScheduleService` (–º–∏–Ω–∏–º—É–º 4 —Ç–µ—Å—Ç–∞)
  - `WorkspaceService` (–º–∏–Ω–∏–º—É–º 3 —Ç–µ—Å—Ç–∞)
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç mocks/fixtures
- [ ] –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `pytest`
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >70% –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–º–µ—é—Ç unit-—Ç–µ—Å—Ç—ã
- –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞ —Å–ª–æ–º–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

---

### –ó–∞–¥–∞—á–∞ 4.2: –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö API endpoints.

**–§–∞–π–ª—ã –∫ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
- `tests/integration/test_api.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

```python
# tests/integration/test_api.py
import pytest
from httpx import AsyncClient
from app.main import app
from app.models import User, Team, Workspace

@pytest.mark.asyncio
class TestUserAPI:
    async def test_create_user(self, async_client: AsyncClient, admin_token: str):
        # Arrange
        user_data = {
            "name": "New User",
            "email": "user@example.com",
            "timezone": "Europe/Moscow"
        }

        # Act
        response = await async_client.post(
            "/api/v1/users",
            json=user_data,
            headers={"Authorization": f"Bearer {admin_token}"}
        )

        # Assert
        assert response.status_code == 201
        assert response.json()["name"] == "New User"

    async def test_list_users(self, async_client: AsyncClient, admin_token: str):
        # Act
        response = await async_client.get(
            "/api/v1/users",
            headers={"Authorization": f"Bearer {admin_token}"}
        )

        # Assert
        assert response.status_code == 200
        assert isinstance(response.json(), list)

@pytest.mark.asyncio
class TestScheduleAPI:
    async def test_create_schedule(self, async_client: AsyncClient, admin_token: str):
        # Arrange
        schedule_data = {
            "team_id": 1,
            "user_id": 1,
            "date": "2025-12-25"
        }

        # Act
        response = await async_client.post(
            "/api/v1/schedules",
            json=schedule_data,
            headers={"Authorization": f"Bearer {admin_token}"}
        )

        # Assert
        assert response.status_code == 201
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –ù–∞–ø–∏—Å–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö endpoints:
  - User API (create, list, update, delete)
  - Team API (create, list, update, delete)
  - Schedule API (create, list, update, delete)
- [ ] –¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—É—é –ë–î (–≤ –ø–∞–º—è—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### –ó–∞–¥–∞—á–∞ 4.3: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –æ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ –≥–∞–π–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**–§–∞–π–ª—ã –∫ —Å–æ–∑–¥–∞–Ω–∏—é:**
```
docs/
‚îú‚îÄ‚îÄ REFACTORING_PLAN.md      (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ ARCHITECTURE.md          # –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–æ–µ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ API_GUIDE.md            # –ì–∞–π–¥ –ø–æ API
‚îú‚îÄ‚îÄ DEVELOPMENT.md          # –ì–∞–π–¥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îú‚îÄ‚îÄ TESTING.md              # –ì–∞–π–¥ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
‚îî‚îÄ‚îÄ DEPLOYMENT.md           # –ì–∞–π–¥ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**

```markdown
# docs/ARCHITECTURE.md

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **Presentation Layer (–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã)**
   - `app/web/api/` - REST API endpoints
   - `app/handlers/` - Telegram/Slack –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
   - –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –ü–∞—Ä—Å–∏–Ω–≥ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤, HTTP –æ—Ç–≤–µ—Ç—ã, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

2. **Business Logic Layer (–°–µ—Ä–≤–∏—Å—ã)**
   - `app/services/` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –í–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

3. **Data Access Layer (–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)**
   - `app/repositories/` - –†–∞–±–æ—Ç–∞ —Å –ë–î
   - –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, SQL –∑–∞–ø—Ä–æ—Å—ã

4. **Domain Layer (–ú–æ–¥–µ–ª–∏)**
   - `app/models.py` - SQLAlchemy –º–æ–¥–µ–ª–∏
   - –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å: –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `docs/ARCHITECTURE.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `docs/DEVELOPMENT.md` —Å –≥–∞–π–¥–æ–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `docs/TESTING.md` —Å –≥–∞–π–¥–æ–º –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –ø–æ–Ω—è—Ç–Ω–∞
- [ ] –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

**–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞:**
- –ù–æ–≤—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∑–∞ 30 –º–∏–Ω—É—Ç —á—Ç–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üìÖ –ì—Ä–∞—Ñ–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –§–∞–∑–∞ | –ó–∞–¥–∞—á–∏ | –ß–∞—Å—ã | –ù–µ–¥–µ–ª—è |
|------|--------|------|--------|
| **1** | 1.1 + 1.2 + 1.3 | 10-12 | 1-2 |
| **2** | 2.1 + 2.2 + 2.3 | 8-10 | 2-3 |
| **3** | 3.1 + 3.2 + 3.3 | 6-8 | 3 |
| **4** | 4.1 + 4.2 + 4.3 | 8-10 | 4 |
| **–ò–¢–û–ì–û** | | **32-40 —á–∞—Å–æ–≤** | **4 –Ω–µ–¥–µ–ª–∏** |

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ)

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º, –∫–æ–≥–¥–∞:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:**
   - [ ] –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (–≤—Å–µ —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
   - [ ] –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, –∞ –Ω–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
   - [ ] –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ <300 —Å—Ç—Ä–æ–∫
   - [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ >5 —Å—Ç—Ä–æ–∫ (–ø–æ—Ö–æ–∂–∏–µ –ª–æ–≥–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω—ã –≤ —É—Ç–∏–ª–∏—Ç—ã)
   - [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É: –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã ‚Üí —Å–µ—Ä–≤–∏—Å—ã ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Üí –ë–î

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏:**
   - [ ] –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç (web API + Telegram handlers + Slack handlers)
   - [ ] –í—Å–µ —Ñ–∏—á–µ, —á—Ç–æ –±—ã–ª–∏ –¥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞, –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç
   - [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

3. **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞:**
   - [ ] –ö–æ–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç linting (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   - [ ] –í—Å–µ type hints –¥–æ–±–∞–≤–ª–µ–Ω—ã
   - [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞

4. **–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ (>70% –ø–æ–∫—Ä—ã—Ç–∏–µ)
   - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è API
   - [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞ (–¥–æ –∏ –ø–æ—Å–ª–µ)

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –¶–µ–ª—å |
|---------|-------|-------|------|
| –ú–∞–∫—Å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | 1559 —Å—Ç—Ä–æ–∫ | <300 —Å—Ç—Ä–æ–∫ | ‚úÖ |
| –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î | 70+ –º–µ—Å—Ç | 0 –º–µ—Å—Ç | ‚úÖ |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | 66% | <10% | ‚úÖ |
| –†–∞–∑–º–µ—Ä —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ | 0 —Ñ–∞–π–ª–æ–≤ | 8 —Ñ–∞–π–ª–æ–≤ | ‚úÖ |
| –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ | 0% | >70% | ‚úÖ |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞** | **4/10** | **8/10** | **‚úÖ** |

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ –ø–æ—Ä—è–¥–∫—É
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –¥–µ–ª–∞—Ç—å commit —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ —Å–ª–æ–º–∞–Ω–∞
- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏ –æ–±—Å—É–∂–¥–∞—Ç—å –≤ issue

---

**–ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω:** 2025-12-24
**–°—Ç–∞—Ç—É—Å:** üìã –í –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–¥–æ–±—Ä–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∏ –Ω–∞—á–∞–ª–æ –§–∞–∑—ã 1, –ó–∞–¥–∞—á–∞ 1.1
